##########################################
### Global parameters for all projects ###
##########################################
parameters: &global_params 
  # Either a file with individual in the 1st column, population in the 2nd column
  popmap: "data/popmap.txt"
  # or a separator to extract population codes from individual IDs
  popseparator: "-" # e.g. "ind1-pop1", separator is "-"
  # (if both popdata and popseparator are provided, popmap file takes precedence)
  
  ## Population data file
  # This is used for analyses that incorporate geographic information,
  # such as plotting structure results on a map or coloring PCA plots by geography.
  # A file with the following columns:
  # - Site (population)
  # - Lat (latitude - x coordinate; decimal degrees)
  # - Lon (longitude - y coordinate; decimal degrees)
  # - optional additional columns with population stratification (e.g. region, mountain range, etc.)
  # Example:
  # Site Lat  Lon Region
  # pop1  52.23 21.01 region1
  # pop2  51.50 -0.13 region2
  popdata: "data/popdata.txt"
  
  ## Preprocessing parameters
  #
  # Many analyses require unlinkesd SNPs (one SNP per RAD fragment).
  # The VCF file will is first filtered for bilallelic SNPs with MAC>1
  # and then thinned to one SNP per RAD fragment using the parameters below.
  #
  vcf_filtering:
    f_missing: 0 # maximum missing data threshold for variant filtering
                 # variants missing in > f_missing proportion of samples are filtered out
                 # 1 keeps all variants, 0 removes variants with any missing data
    
  # VCF thinning strategy: "thinning" (one SNP per RAD fragment), "ld_pruning" (LD-based pruning), or "none" (no pruning/thinning)
  thinning_strategy: "ld_pruning"  # options: "thinning", "ld_pruning", or "none"
  
  # VCF thinning parameters (defaults shown):
  # Used when thinning_strategy is "thinning"
  vcf_thinning:
    min_coverage: 0          # minimum number of samples with data
    method: "max_coverage"   # selection method: random, max_coverage, or weighted
    ties: "random"           # handle ties in max_coverage: first or random
    ns_tag: "NS"             # INFO field tag for number of samples with data
    id_pattern: "loc(\\d+)_" # regex pattern to extract RAD fragment ID
  
  # LD pruning parameters (defaults shown):
  # Used when thinning_strategy is "ld_pruning"
  ld_pruning:
    r2: 0.5          # R-squared threshold for LD pruning (default: 0.5)
    window_size: 50  # window size in kb for LD pruning (default: 50)
    step_size: 5      # step size in kb for LD pruning (default: 5)
  
  ## Relatedness filtering parameters
  # Filter related/clonal individuals using plink2 KING method
  relatedness_filtering:
    enabled: true  # enable/disable relatedness filtering (default: false)
    king_threshold: 0.0884  # KING kinship threshold for filtering (default: 0.0884, equivalent to PI-HAT > 0.2, 2nd-degree relatives)
                            # Common values: 0.354 (duplicates/twins), 0.177 (1st-degree), 0.0884 (2nd-degree), 0.0442 (3rd-degree)
    mac_threshold: 1  # minimum MAC for KING calculation (default: 1)
    group_by: ["Region"]  # list of columns from popdata to group barplots by (default: ["Region"])
                          # Similar to pixy.color_by and pca_plot.color_by
                          # Each value in the list generates a separate barplot grouped by that column
                          # Use ["none"] or [] for no grouping (overall plot only)
                          # Example: ["Region", "Population"] generates plots grouped by Region and by Population
  
  ## Population Structure Analysis
  # Common K values to test for population structure (Structure, fastStructure and admixture):
  k_values: [1, 2, 3, 4, 5, 6, 7, 8, 9]

  ## Map background parameters (shared across all map plots)
  # These parameters control the base map appearance (boundaries, CRS, colors, decorations)
  # and are shared by mapmixture, population_map, and pixy map plots
  map_boundary: NULL                  # map boundaries, e.g. c(xmin=-15, xmax=16, ymin=40, ymax=62)
  map_background:
    width: 10                       # plot width in inches
    height: 8                       # plot height in inches
    dpi: 300                        # dots per inch (resolution)
    crs: 4326                       # coordinate reference system (4326 = WGS84 lat/lon)
    basemap: NULL                   # optional basemap object
    land_colour: "#d9d9d9"          # color for land masses
    sea_colour: "#deebf7"           # color for water bodies
    expand: FALSE                   # expand map to fill plotting area (TRUE/FALSE)
    arrow: TRUE                     # show north arrow (TRUE/FALSE)
    arrow_size: 1                   # size of north arrow
    arrow_position: "tl"            # position of north arrow (tl/tr/bl/br)
    scalebar: TRUE                  # show scale bar (TRUE/FALSE)
    scalebar_size: 1                # size of scale bar
    scalebar_position: "tl"         # position of scale bar (tl/tr/bl/br)
    plot_title: ""                  # title for the plot
    axis_title_size: 10             # font size for axis titles
    axis_text_size: 8               # font size for axis text
    basemap_border: TRUE            # show border around basemap (TRUE/FALSE)
    basemap_border_col: "black"     # color of basemap border
    basemap_border_lwd: 0.1         # line width of basemap border

  ## Mapmixture plotting parameters
  # Parameters specific to structure/admixture map plots (pie charts, colors, barplots)
  mapmixture:
    # Pie chart parameters
    pie_size: 0.2                   # size of pie charts on map
    pie_border: 0.2                 # thickness of pie chart borders
    pie_border_col: "black"         # color of pie chart borders
    pie_opacity: 1                  # opacity of pie charts (0-1)
    legend: FALSE                   # show legend (TRUE/FALSE)
    # Structure color palette 
    structure_colors:
      - "#E41A1C"  # red
      - "#377EB8"  # blue
      - "#4DAF4A"  # green
      - "#984EA3"  # purple
      - "#FF7F00"  # orange
      - "#FFFF33"  # yellow
      - "#A65628"  # brown
      - "#F781BF"  # pink
      - "#999999"  # gray
      - "#FFFFFF"  # white
      - "#000000"  # black
    # Structure barplot parameters
    site_dividers: TRUE             # show dividers between sites
    divider_width: 0.4              # width of site dividers
    site_order: NULL                # custom site order as list, e.g. ["Site1", "Site2", "Site3"]
    flip_axis: FALSE                # flip barplot axis
    site_labels_angle: 45           # angle for site labels (90 = perpendicular, 0 = horizontal)

  ## Population map plotting parameters
  # Parameters specific to population location maps (points, labels, leader lines)
  population_map:
    # Point styling
    point_size: 1                # size of population points
    point_color: "black"         # color of population points
    point_shape: 19              # shape of points (19 = filled circle)
    show_points: true            # show population points (true/false)
    # Label styling
    label_size: 3                # font size for labels
    label_color: "black"         # color of labels
    label_fontface: "plain"      # font face: plain, bold, italic, bold.italic
    show_labels: true            # show population labels (true/false)
    # ggrepel parameters for label positioning
    force: 10                    # force of repulsion between labels
    force_pull: 1                # force pulling labels toward points
    max.overlaps: Inf            # maximum number of overlapping labels to show (Inf = show all labels)
    min.segment.length: 0        # minimum length of leader line segment (in map units)
    segment.color: "black"       # color of leader lines
    segment.size: 0.2            # line width of leader lines

  ## MAPI parameters
  # MAPI (Mapping Averaged Pairwise Information) identifies spatial patterns of genetic diversity
  # by comparing genetic distances to geographic distances across a hexagonal grid
  mapi:
    n_permutations: 1000        # number of permutations for significance testing
    grid_halfwidth: NULL      # grid cell halfwidth in meters (NULL for auto-estimation)
    crs_projected: "EPSG:8857"  # projected CRS for distance calculations ("EPSG:8857" = Equal Earth, EPSG:3035 = ETRS89 / ETRS-LAEA Europe, EPSG:2180 = Poland CS2000)
    crs_geographic: 4326        # geographic CRS for lat/lon coordinates (4326 = WGS84)
    alpha: 0.05                 # significance level for upper/lower tail identification

  ## Structure parameters
  # More run parameters can be tweaked by modifying `data/mainparams` and `data/extraparams`
  # Numbers of individuals and loci are automatically inferred from .ustr file so this does not need to be changed.
  structure:
    replicates: 10       # number of replicates for structure
  
  ## FastStructure parameters (defaults shown)
  faststructure:
    tol: "10e-6"        # convergence criterion
    prior: "simple"     # prior choice: simple or logistic
  
  ## conStruct parameters
  # conStruct (spatial population structure analysis incorporating geography)
  construct:
    n_chains: 4        # number of MCMC chains to run (recommended: 2-4 for proper convergence diagnostics)
    n_iterations: 50000  # number of MCMC iterations per chain (recommended: 20000-50000 for better ESS)
    make.freqs: true   # whether to make allele frequencies from genotype data
    geoDist: null      # optional pre-computed geographic distance matrix (null = compute from coords)
    coords: null       # optional coordinate matrix (null = use from indpopdata)
    save.files: true   # whether to save intermediate files
    crs: 4326          # coordinate reference system for plotting (4326 = WGS84)
  
  ## PCAone parameters
  #
  # SVD method SVD method to be applied.
  # Options are
  # 0: the Implicitly Restarted Arnoldi Method (IRAM);
  # 1: the Yu's single-pass Randomized SVD with power iterations;
  # 2: the accurate window-based Randomized SVD method (PCAone), recommended for big data;
  # 3: the full Singular Value Decomposition (default).
  # Minimum coverage thresholds to filter VCF for missing data before PCAone analysis.
  # The VCF will be filtered for each threshold in the list and PCAone will be run
  # on each filtered dataset.
  PCAone:
    miss: [0.1, 0.2, 0.2, 0.3, 0.4, 0.5] # list of maximum missing data thresholds (F_MISSING<mincov)
    SVD_method: 3 # SVD method to use [0-3]
    PCnum: 10     # number of principal components to compute
  # PCA plot params:
  pca_plot:
    pc_max: 4  # maximum PC axis number - will generate all combinations up to this value
               # e.g., pc_max=4 generates: 1/2, 2/3, 3/4, 1/3, 2/4, 1/4
    color_by: ["Region"]  # columns in popdata to color points by (must match your popdata column names!)
    include_missing: true  # set to true to calculate per-sample missing data from VCF files
                          # when true and "missing" is in color_by list, creates missing-data-colored PCA plots
    pca_colors:  # color palette for categorical variables in PCA plots
      - "#E41A1C"  # red
      - "#377EB8"  # blue
      - "#4DAF4A"  # green
      - "#984EA3"  # purple
      - "#FF7F00"  # orange
      - "#FFFF33"  # yellow
      - "#A65628"  # brown
      - "#F781BF"  # pink
      - "#999999"  # gray
      - "#FFFFFF"  # white
      - "#000000"  # black
  
  ## VCF2PCACluster parameters
  #
  vcf2pcacluster:
    cluster_method: "Kmean"  # clustering method: EM/Kmean/DBSCAN/None
    PCnum: 10     # number of principal components to use
    SNP_filtering:
      MAF: [0, 0.001, 0.01, 0.05]   # List of min minor allele frequency filters [0.001]
      Miss: [0.3, 0.4, 0.5]  # list of max ratio of miss allele filter [0.25] but in this pipeline [0.5], might fail if too low
      Het: 1.00   # Max ratio of het allele filter [1.00]
      HWE: 0      # Exact test of Hardy-Weinberg Equilibrium for SNP Pvalue[0]
      Fchr: ""    # Filter the chromosome
    KinshipMethod: 1 # Method of Kinship [1-5],defaut [1]
                     # 1:Normalized_IBS[(Yang/BaldingNicolsKinship]
                     # 2:Centered_IBS(VanRaden)
                     # 3:IBSKinshipImpute 4:IBSKinship 5:p_dis
  
  ## Pixy parameters
  pixy:
    stats: "pi fst dxy"  # statistics to compute, options: pi, fst, dxy
    window_size: 10000  # size of the sliding window in bp
    bootstrap_replicates: 1000  # number of bootstrap replicates for confidence intervals
    color_by: ["Region"]  # columns in popdata to color barplots by (must match your popdata column names!)
                          # separate from pca_plot.color_by - allows different groupings for pixy vs PCA
    # Map-specific parameters for pixy PI maps
    point_size: 3        # size of points on genetic diversity maps
    map_outline: true    # add point outlines (true/false, default: true)

  ## Genome scan parameters
  genome_scan:
    population_column: "Group"  # column name in popdata/indpopdata to extract populations from
    pop1: "Northern"  # name of first population (must match value in population_column)
    pop2: "Southern"  # name of second population (must match value in population_column)
    window_size_fst: 100  # window size in bp for FST (for dot plot visualization)
    window_size_pi: 1000000  # window size in bp for Ï€ (1 Mb for curve visualization)
    window_size_dxy: 1000000  # window size in bp for dXY (1 Mb for curve visualization)

  ## ROH parameters
  roh:
    group_by: ["Site"]  # list of columns from indpopdata to group plots by (default: ["Site"])
                        # Each value in the list generates separate plots grouped by that column
                        # Use ["none"] or [] for no grouping (overall plots only)
                        # Example: ["Site", "Region"] generates plots grouped by Site and by Region

  ## Relatedness plot parameters
  relatedness_plot:
    color_by: ["none"]  # columns in indpopdata to color nodes by (must match your indpopdata column names!)
                        # Each value in the list generates separate plots colored by that column
                        # Use ["none"] for no coloring (default gray nodes)
                        # Example: ["Site", "Group"] generates plots colored by Site and by Group
    relatedness_colors:  # color palette for categorical variables in relatedness plots
      - "#E41A1C"  # red
      - "#377EB8"  # blue
      - "#4DAF4A"  # green
      - "#984EA3"  # purple
      - "#FF7F00"  # orange
      - "#FFFF33"  # yellow
      - "#A65628"  # brown
      - "#F781BF"  # pink
      - "#999999"  # gray
      - "#FFFFFF"  # white
      - "#000000"  # black

  ## fineRADstructure parameters
  fineradstructure:
    cluster:
      mcmc_iterations: 1000000  # -x: number of MCMC iterations for clustering
      burnin: 1000000           # -y: number of burn-in iterations
      thinning: 1000            # -z: thinning interval (sample every z iterations)
    tree:
      mcmc_iterations: 10000    # -x: number of MCMC iterations for tree building

  ## Trimal parameters for alignment trimming before phylogenetic inference
  trimal:
    gt: 0.95        # gap threshold for trimming alignments (0-1 where 0=no gaps, 1=no trimming)

  ## IQ-TREE parameters
  iqtree:
    model: "MFP"      # substitution model, MFP for ModelFinder Plus
    bootstraps: 1000  # number of ultrafast bootstrap replicates
    robust-phy: 0.95 # robustness threshold for phylogenetic inference (0-1)
    # outgroup: "sample1,sample2"  # optional: comma-separated list of outgroup taxa
    support_threshold: 70  # minimum bootstrap support value to display on tree (0-100)

  ## AMOVA parameters
  # AMOVA (Analysis of Molecular Variance) partitions genetic variance into hierarchical components
  amova:
    strata: ["Region", "Site"]  # hierarchical stratification levels (e.g., ["Region", "Site"])
                                 # Each level must be a column name in popdata.txt
                                 # Order matters: first element is the highest level, last is the population level
                                 # Example: ["Region", "Site"] creates hierarchy: Region > Site
                                 #           where Site is the population level (most nested)
                                 # Must specify at least one level (the population level)
    nperm: 999  # number of permutations for significance testing

  ## Analysis resources
  #
  # Define computational resources for different analysis steps.
  # Memory is in MB and threads is the number of CPU threads.
  # Runtime is in minutes.
  resources: &global_resources
    default: # default resources for simple steps like file conversion
      threads: 1
      mem_mb: 8000
      runtime: 10
    default-long: # default resources for longer steps like filtering
      threads: 1
      mem_mb: 8000
      runtime: 60
    structure:
      threads: 1
      mem_mb: 8000
      runtime: 4320
    faststructure:
      threads: 4
      mem_mb: 8000
      runtime: 120
    admixture:
      threads: 4
      mem_mb: 16000
      runtime: 10
    pcaone:
      threads: 12
      mem_mb: 8000
      runtime: 30
    pcaone_emu:
      threads: 12
      mem_mb: 8000
      runtime: 10
    vcf2pcacluster:
      threads: 12
      mem_mb: 8000
      runtime: 10
    pixy:
      threads: 24
      mem_mb: 8000
      runtime: 600
    genome_scan:
      threads: 24
      mem_mb: 8000
      runtime: 720
    iqtree:
      threads: 12
      mem_mb: 8000
      runtime: 720
    mapi:
      threads: 4
      mem_mb: 16000
      runtime: 240
    construct:
      threads: 4
      mem_mb: 16000
      runtime: 1440
    dapc:
      threads: 1
      mem_mb: 8000
      runtime: 10
    relatedness_filtering:
      threads: 4
      mem_mb: 16000
      runtime: 120 
    amova:
      threads: 1
      mem_mb: 16000
      runtime: 120
    roh:
      threads: 4
      mem_mb: 8000
      runtime: 60

##############################
### Projects configuration ###
##############################
projects:
  TestProject:
    ipyrad_prefix: "test_data/test"
    ## Analysis selection - set to true/false to enable/disable
    analyses:
      structure: false
      faststructure: false
      admixture: false
      evaladmix: false
      construct: false
      mapi: false
      pcaone: false
      vcf2pcacluster: false
      pcaone_emu: false
      pcaone_miss: false
      pixy: true
      genome_scan: false
      relatedness: true
      iqtree: false
      iqtree_trimal: false
      dapc: true
      iqtree_robust: false
      fineradstructure: false
      plot_map: false
      amova: false
      roh: false
    parameters:
      <<: *global_params
      popmap: "data/popmap.txt"
      popdata: "data/popdata.txt"