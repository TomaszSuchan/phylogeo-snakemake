##########################################
### Global parameters for all projects ###
##########################################
parameters: &global_params 
  # Either a file with individual in the 1st column, population in the 2nd column
  popmap: "data/popmap.txt"
  # or a separator to extract population codes from individual IDs
  popseparator: "-" # e.g. "ind1-pop1", separator is "-"
  # (if both popdata and popseparator are provided, popmap file takes precedence)
  
  ## Population data file
  # This is used for analyses that incorporate geographic information,
  # such as plotting structure results on a map or coloring PCA plots by geography.
  # A file with the following columns:
  # - Site (population)
  # - Lat (latitude - x coordinate; decimal degrees)
  # - Lon (longitude - y coordinate; decimal degrees)
  # - optional additional columns with population stratification (e.g. region, mountain range, etc.)
  # Example:
  # Site Lat  Lon Region
  # pop1  52.23 21.01 region1
  # pop2  51.50 -0.13 region2
  popdata: data/popdata.txt
  
  ## Preprocessing parameters
  #
  # Many analyses require unlinkesd SNPs (one SNP per RAD fragment).
  # The VCF file will is first filtered for bilallelic SNPs with MAC>1
  # and then thinned to one SNP per RAD fragment using the parameters below.
  #
  # VCF thinning parameters (defaults shown):
  vcf_thinning:
    min_coverage: 0          # minimum number of samples with data
    method: "max_coverage"   # selection method: random, max_coverage, or weighted
    ties: "random"           # handle ties in max_coverage: first or random
    ns_tag: "NS"             # INFO field tag for number of samples with data
    id_pattern: "loc(\\d+)_" # regex pattern to extract RAD fragment ID
  
  ## Population Structure Analysis
  # Common K values to test for population structure (Structure, fastStructure and admixture):
  k_values: [1, 2, 3, 4, 5]

  ## Mapmixture plotting parameters
  # These parameters control the appearance of map-based structure plots
  mapmixture:
    width: 10                       # plot width in inches
    height: 8                       # plot height in inches
    dpi: 300                        # dots per inch (resolution)
    boundary: NULL                  # map boundaries, e.g. c(xmin=-15, xmax=16, ymin=40, ymax=62)
    crs: 4326                       # coordinate reference system (4326 = WGS84 lat/lon)
    basemap: NULL                   # optional basemap object
    pie_size: 1                     # size of pie charts on map
    pie_border: 0.2                 # thickness of pie chart borders
    pie_border_col: "black"         # color of pie chart borders
    pie_opacity: 1                  # opacity of pie charts (0-1)
    land_colour: "#d9d9d9"          # color for land masses
    sea_colour: "#deebf7"           # color for water bodies
    expand: FALSE                   # expand map to fill plotting area (TRUE/FALSE)
    arrow: TRUE                     # show north arrow (TRUE/FALSE)
    arrow_size: 1                   # size of north arrow
    arrow_position: "tl"            # position of north arrow (tl/tr/bl/br)
    scalebar: TRUE                  # show scale bar (TRUE/FALSE)
    scalebar_size: 1                # size of scale bar
    scalebar_position: "tl"         # position of scale bar (tl/tr/bl/br)
    legend: FALSE                   # show legend (TRUE/FALSE)
    plot_title: ""                  # title for the plot
    axis_title_size: 10             # font size for axis titles
    axis_text_size: 8               # font size for axis text
    basemap_border: TRUE            # show border around basemap (TRUE/FALSE)
    basemap_border_col: "black"     # color of basemap border
    basemap_border_lwd: 0.1         # line width of basemap border
    # Structure barplot parameters (based on mapmixture defaults)
    cluster_cols: NULL              # list of colors for clusters, e.g. ["#f1a340", "#998ec3"]
    site_dividers: TRUE             # show dividers between sites
    divider_width: 0.4              # width of site dividers
    site_order: NULL                # custom site order as list, e.g. ["Site1", "Site2", "Site3"]
    flip_axis: FALSE                # flip barplot axis


  ## Structure parameters
  # More run parameters can be tweaked by modifying `data/mainparams` and `data/extraparams`
  # Numbers of individuals and loci are automatically inferred from .ustr file so this does not need to be changed.
  structure:
    replicates: 2       # number of replicates for structure
  
  ## FastStructure parameters (defaults shown)
  faststructure:
    tol: "10e-6"        # convergence criterion
    prior: "simple"     # prior choice: simple or logistic
  
  ## PCAone parameters
  #
  # SVD method SVD method to be applied.
  # Options are
  # 0: the Implicitly Restarted Arnoldi Method (IRAM);
  # 1: the Yu's single-pass Randomized SVD with power iterations;
  # 2: the accurate window-based Randomized SVD method (PCAone), recommended for big data;
  # 3: the full Singular Value Decomposition (default).
  # Minimum coverage thresholds to filter VCF for missing data before PCAone analysis.
  # The VCF will be filtered for each threshold in the list and PCAone will be run
  # on each filtered dataset.
  PCAone:
    miss: [0.1, 0.2, 0.2, 0.3, 0.4, 0.5] # list of maximum missing data thresholds (F_MISSING<mincov)
    SVD_method: 3 # SVD method to use [0-3]
    PCnum: 10     # number of principal components to compute
  # PCA plot params:
  pca_plot:
    pc_max: 4  # maximum PC axis number - will generate all combinations up to this value
               # e.g., pc_max=4 generates: 1/2, 2/3, 3/4, 1/3, 2/4, 1/4
    color_by: ["Population", "Region"]  # columns in popdata to color points by
  
  ## VCF2PCACluster parameters
  #
  vcf2pcacluster:
    cluster_method: "Kmean"  # clustering method: EM/Kmean/DBSCAN/None
    PCnum: 10     # number of principal components to use
    SNP_filtering:
      MAF: [0, 0.001, 0.01, 0.05]   # List of min minor allele frequency filters [0.001]
      Miss: [0.3, 0.4, 0.5]  # list of max ratio of miss allele filter [0.25] but in this pipeline [0.5], might fail if too low
      Het: 1.00   # Max ratio of het allele filter [1.00]
      HWE: 0      # Exact test of Hardy-Weinberg Equilibrium for SNP Pvalue[0]
      Fchr: ""    # Filter the chromosome
    KinshipMethod: 1 # Method of Kinship [1-5],defaut [1]
                     # 1:Normalized_IBS[(Yang/BaldingNicolsKinship]
                     # 2:Centered_IBS(VanRaden)
                     # 3:IBSKinshipImpute 4:IBSKinship 5:p_dis
  
  ## Pixy parameters
  pixy:
    stats: "pi fst dxy"  # statistics to compute, options: pi, fst, dxy
    window_size: 10000  # size of the sliding window in bp

  ## Trimal parameters for alignment trimming before phylogenetic inference
  trimal:
    gt: 0.95        # gap threshold for trimming alignments (0-1 where 0=no gaps, 1=no trimming)

  ## IQ-TREE parameters
  iqtree:
    model: "MFP"      # substitution model, MFP for ModelFinder Plus
    bootstraps: 1000  # number of ultrafast bootstrap replicates
    robust-phy: 0.95 # robustness threshold for phylogenetic inference (0-1)
    # outgroup: "sample1,sample2"  # optional: comma-separated list of outgroup taxa
    support_threshold: 70  # minimum bootstrap support value to display on tree (0-100)

  ## Whoa QC parameters
  # Whoa analyzes heterozygote miscall rates to assess genotyping accuracy
  whoa:
    min_bin: 1000  # minimum bin size for read depth categorization (higher = fewer bins)

  ## Hardy-Weinberg equilibrium test parameters
  # Tests for deviations from HWE which may indicate genotyping errors or selection
  hw_qc:
    alpha: 0.05  # significance threshold for HWE test

  ## Replicate QC parameters
  # Analyzes technical replicates to assess genotyping error rates
  # Requires a separate assembly with replicate pairs
  # Use a separate project entry with its own ipyrad_prefix pointing to the replicate assembly
  replicate_qc:
    suffix: "_repl"  # Suffix pattern in replicate sample names (e.g., "_repl" for "sample_repl04a")

  ## Analysis resources
  #
  # Define computational resources for different analysis steps.
  # Memory is in MB and threads is the number of CPU threads.
  # Runtime is in minutes.
  resources: &global_resources
    default: # default resources for simple steps like file conversion
      threads: 1
      mem_mb: 8000
      runtime: 10
    default-long: # default resources for longer steps like filtering
      threads: 1
      mem_mb: 8000
      runtime: 60
    structure:
      threads: 1
      mem_mb: 8000
      runtime: 1440
    faststructure:
      threads: 4
      mem_mb: 8000
      runtime: 120
    admixture:
      threads: 4
      mem_mb: 16000
      runtime: 10
    pcaone:
      threads: 12
      mem_mb: 8000
      runtime: 30
    pcaone_emu:
      threads: 12
      mem_mb: 8000
      runtime: 10
    vcf2pcacluster:
      threads: 12
      mem_mb: 8000
      runtime: 10
    pixy:
      threads: 24
      mem_mb: 8000
      runtime: 600
    iqtree:
      threads: 12
      mem_mb: 8000
      runtime: 720

##############################
### Projects configuration ###
##############################
projects:
  Dataset_1:
    ipyrad_prefix: "test_data/test"
    ## Analysis selection - set to true/false to enable/disable
    analyses:
      structure: false
      faststructure: false
      admixture: false
      pcaone: false
      vcf2pcacluster: false
      pcaone_emu: false
      pcaone_miss: false
      pixy: false
      relatedness: false
      iqtree: false
      iqtree_trimal: false
      iqtree_robust: false
      qc_whoa: false  # Genotyping accuracy QC analysis
      qc_hw: false  # Hardy-Weinberg equilibrium test
      qc_replicate: false  # Technical replicate error rate analysis
    parameters:
      <<: *global_params
  Dataset_2:
    ipyrad_prefix: "test_data/test"
    ## Analysis selection - set to true/false to enable/disable
    analyses:
      structure: false
      faststructure: false
      admixture: false
      pcaone: false
      vcf2pcacluster: false
      pcaone_emu: false
      pcaone_miss: false
      pixy: false
      relatedness: false
      iqtree: false
      iqtree_trimal: false
      iqtree_robust: false
      qc_whoa: false
      qc_hw: false
      qc_replicate: false
    parameters:
      <<: *global_params